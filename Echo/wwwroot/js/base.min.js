class Keylogger {
	static #keys = [];
	static #list = [];
	static showKeys = false;

	static {
		window.addEventListener("keydown", e => {
			if (Keylogger.showKeys) {
				console.log(e);
			}
			Keylogger.append(e.keyCode);
		});

		window.addEventListener("keyup", e => {
			var keys = Keylogger.getKeys();
			var list = Keylogger.getList();
			var i = 0;

			if (Keylogger.showKeys) {
				console.log(e);
			}
			while (i < keys.length) {
				if (e.keyCode == keys[i]) {
					keys = Keylogger.remove(i).getKeys();
				}
				else {
					i++;
				}
			}
			list.forEach(item => {
				if (item.keyCode == e.keyCode) {
					item.func(e, item);
				}
			});
		});
	}

	static press = (keyCode, func) => {
		var info = {
			"keyCode" : keyCode,
			"func" : func
		}
		Keylogger.#list.push(info);
		return Keylogger;
	}

	static unpress = (keyCode, func) => {
		var i = 0;
		while (i < Keylogger.#list.length) {
			if (typeof func != "function") {
				if (Keylogger.#list[i].keyCode == keyCode) {
					var removed = Keylogger.#list.splice(i, 1)[0]
				}
				else {
					i++;
				}
			}
			else {
				if (Keylogger.#list[i].keyCode == keyCode && Keylogger.#list[i].func == func) {
					var removed = Keylogger.#list.splice(i, 1)[0]
				}
				else {
					i++;
				}
			}
		}
		return this;
	}

	static getKeys = () => {
		return Keylogger.#keys;
	}

	static getList = () => {
		return Keylogger.#list;
	}

	static append = (keyCode) => {
		Keylogger.#keys.push(keyCode);
		
		return this;
	}

	static wipe = () => {
		Keylogger.#keys = [];
		return this;
	}

	static remove = (i) => {
		Keylogger.#keys.splice(i, 1);
		return this;
	}
}

class Cookies {
	static set = (cname, cvalue, exmin) => {
		try {
			var d = new Date();
			d.setTime(d.getTime() + (exmin*60*1000));
			var expires = "expires="+ d.toUTCString();
			document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";}
		catch {
			return "";
		}
		return "ok";
	}

	static get = cname => {
		var name = cname + "=";
		var ca = document.cookie.split(';');
		
		for(var i = 0; i < ca.length; i++) {
			var c = ca[i];
			
			while (c.charAt(0) == ' ') {
				c = c.substring(1);
			}
			
			if (c.indexOf(name) == 0) {
				return c.substring(name.length, c.length);
			}
		}
		return "";
	}
}
